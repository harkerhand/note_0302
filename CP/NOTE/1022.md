# 语法分析（自上而下）

![[../../assets/image 19.png|image 19.png]]

  

- 从词法分析器获取 token
- 检查啊这些 token 是否由 文法grammar 生成
- 报告语法错误
- 尝试从错误中恢复
- 若输入正确，生成语法分析树

**两种方法：Top-Down Bottom-Up**

**错误类型：**

|类型|示例|
|---|---|
|词法错误|拼写错标识符或关键字|
|语法错误|括号不匹配|
|语义错误|不兼容的操作符类型|
|逻辑错误|无限递归|

常见的错误恢复策略包括：

- **Panic 模式**：丢弃输入直到遇到同步符号；
- **短语级恢复**：替换输入前缀；
- **错误产生式**：在文法中添加错误规则；
- **全局更正**：代价最小的修改。

**自底向上：**

- 逐步减少，需要LR文法

## 自顶向下

- 从文法的**开始符号 S**出发；
- 用左推导（left-most derivation）匹配输入；
- 若不匹配，回溯（backtracking）尝试其他产生式。

可能需要回溯，效率低，改进为预测分析（需要LL1文法）

**LL（1）文法：**

- 无左递归
    - 直接左递归，$P \rightarrow P \alpha | \beta$
        
        $P \rightarrow P\alpha | \beta \ => \ P \rightarrow \beta P',P' \rightarrow \alpha P' | \epsilon$
        
    - 间接左递归，$P \rightarrow Aa, A \rightarrow Pb$
        
        重新排列非终结符，也可以产生相同的语言
        
        ![[../../assets/image 1 14.png|image 1 14.png]]
        
        ![[../../assets/image 2 12.png|image 2 12.png]]
        
- 无左公因子
- 无二义性

### 非递归预测分析器

预测分析器有两个关键部分：

1. **一个符号栈（stack）**
    - 保存尚未匹配完的文法符号（包括终结符和非终结符）。
    - 栈顶是**当前要处理的符号**。
2. **一个输入串（input）**
    - 由词法分析器产生的 token 序列，末尾加 `#` 表示输入结束。
3. **预测分析表（Parsing Table, M）**
    - 表格 `M[非终结符, 当前输入符号] = 对应产生式`。
    - 若该格为空（error），说明输入不符合文法。

分析过程：

不断比较 **栈顶符号 X** 与 **当前输入符号 a**，根据不同情况采取动作。

- 结束条件，X = a = #
- X = a ≠ # 且是终结符，匹配成功，弹出栈顶。
- X 是非终结符，查表，如果是产生式，则把产生式的右边反向压栈，否则报错

### 预测分析表的构造

**FIRST：**

**FIRST(α)**表示**一个符号串 α（可以是终结符或非终结符）能推导出的第一个终结符集合**。