| æ“ä½œåç§°     | ç¬¦å·           | æè¿°                              | ç¤ºä¾‹                                         |
| -------- | ------------ | ------------------------------- | ------------------------------------------ |
| **é€‰æ‹©**   | $\sigma$     | ä»å…³ç³»ä¸­é€‰æ‹©æ»¡è¶³æ¡ä»¶çš„å…ƒç»„                   | $\sigma _{age>20}(S)$                      |
| **æŠ•å½±**   | $\Pi$        | é€‰æ‹©æŒ‡å®šçš„å±æ€§åˆ—                        | $\Pi_{name,major}(S)$                      |
| **å¹¶é›†**   | $\cup$       | ä¸¤ä¸ªå…³ç³»çš„å¹¶é›†ï¼ˆå»é‡ï¼‰                     | $R \cup S$                                 |
| **å·®é›†**   | $-$          | å±äºRä½†ä¸å±äºSçš„å…ƒç»„                     | $R - S$                                    |
| **äº¤é›†**   | $\cap$       | åŒæ—¶å±äºRå’ŒSçš„å…ƒç»„                      | $R \cap S$                                 |
| **ç¬›å¡å°”ç§¯** | $\times$     | ä¸¤ä¸ªå…³ç³»çš„æ‰€æœ‰å¯èƒ½ç»„åˆ                     | $R \times S$                               |
| **é‡å‘½å**  | $\rho$       | é‡å‘½åå…³ç³»æˆ–å±æ€§                        | $\rho_{x(A_1,A_2)}(E)$                     |
| **è‡ªç„¶è¿æ¥** | $\bowtie$    | ä½¿ç”¨ä¸¤ç»„å…³ç³»çš„å…±æœ‰å±æ€§æ¥åˆå¹¶å…³ç³»                | $R \times S$                               |
| **é™¤æ³•**   | $\div$       | æ‰¾å‡ºé‚£äº›åœ¨é›†åˆRä¸­ä¸é›†åˆSçš„æ‰€æœ‰å…ƒç´ éƒ½æœ‰å¯¹åº”å…³ç³»çš„é¡¹ï¼ˆå…¨è¦†ç›–ï¼‰ | $R \div S$                                 |
| **èµ‹å€¼**   | $\leftarrow$ | ç”¨â€œèµ‹å€¼æ“ä½œâ€æŠŠä¸€ä¸ªå…³ç³»èµ‹ç»™ä¸€ä¸ªä¸´æ—¶å˜é‡            | $R \leftarrow S$                           |
| **åˆ†ç»„èšåˆ** | g            | è·å–å€¼çš„é›†åˆå¹¶è¿”å›å•ä¸ªå€¼ä½œä¸ºç»“æœ                | $_{branch\_name}g_{sum(balance)}(account)$ |
| **å¤–éƒ¨è¿æ¥** |              | è‡ªç„¶è¿æ¥ï¼Œä½†ä¿ç•™å…¶ä¸­ä¸€ä¸ªå…³ç³»çš„ä¸åŒ¹é…é¡¹ï¼Œåˆ†ä¸ºå·¦ï¼Œå³ï¼Œå…¨     |                                            |

- **åˆ é™¤ï¼š**$r \leftarrow r - E$ å…¶ä¸­Eæ˜¯å…³ç³»ä»£æ•°æŸ¥è¯¢
- **æ’å…¥ï¼š**$r \leftarrow r \cup E$
- **æ›´æ–°ï¼š**$r \leftarrow E(r)$

# ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€

$\text{å…³ç³»ä»£æ•°} \rightarrow \text{æŸ¥è¯¢è¯­è¨€}$

ä½¿ç”¨SQL1999

**SQL ä¸­çš„åŸŸç±»å‹**

- **char(n)**ï¼šå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œç”¨æˆ·æŒ‡å®šé•¿åº¦ nã€‚
- **varchar(n)**ï¼šå¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œç”¨æˆ·æŒ‡å®šæœ€å¤§é•¿åº¦ nã€‚
- **int**ï¼šæ•´æ•°ï¼ˆæœºå™¨ä¾èµ–çš„æ•´æ•°æœ‰é™å­é›†ï¼‰ã€‚
- **smallint**ï¼šå°æ•´æ•°ï¼ˆæœºå™¨ä¾èµ–çš„æ•´æ•°å­é›†ï¼‰ã€‚
- **numeric(p,d)**ï¼šå®šç‚¹æ•°ï¼Œç”¨æˆ·æŒ‡å®šç²¾åº¦ pï¼ˆæ€»ä½æ•°ï¼‰ï¼Œå…¶ä¸­ d ä½åœ¨å°æ•°ç‚¹å³è¾¹ã€‚
- **real, double precision**ï¼šæµ®ç‚¹æ•°å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œç²¾åº¦å–å†³äºæœºå™¨ã€‚
- **float(n)**ï¼šæµ®ç‚¹æ•°ï¼Œç”¨æˆ·æŒ‡å®šç²¾åº¦è‡³å°‘ä¸º n ä½ã€‚
- æ›´å¤šç±»å‹åœ¨ç¬¬ 4 ç« ä»‹ç»ã€‚

## ğŸ§± ä¸€ã€SQL åŸºç¡€ç»“æ„

SQL æ˜¯ä¸€ç§ **æè¿°æ€§è¯­è¨€ï¼ˆwhatï¼‰**ï¼Œå¯¹åº”å…³ç³»ä»£æ•°ä¸­çš„ï¼š

- **select** â†’ æŠ•å½±ï¼ˆÏ€ï¼‰
- **from** â†’ ç¬›å¡å°”ç§¯ï¼ˆÃ—ï¼‰
- **where** â†’ é€‰æ‹©ï¼ˆÏƒï¼‰

åŸºæœ¬ç»“æ„ï¼š

```SQL
SELECT A1, A2, ...
FROM R1, R2, ...
WHERE æ¡ä»¶;
```

ç»“æœä¾æ—§æ˜¯ä¸€ä¸ª**å…³ç³»è¡¨**ã€‚

---

## ğŸ§¾ äºŒã€æ•°æ®å®šä¹‰ï¼ˆData Define Languageï¼‰

```SQL
create table branch (
  branch_name char(15) primary key,
  branch_city char(30),
  assets integer
);

# é”€æ¯è¡¨
drop table branch;
# ä¿®æ”¹è¡¨ç»“æ„
alter table branch add manager char(20);
```

**çº¦æŸç±»å‹ï¼š**

- `not null`
- `primary key`
- `foreign key`
- `check (balance >= 0)`

---

## ğŸ” ä¸‰ã€åŸºæœ¬æŸ¥è¯¢ç»“æ„ï¼ˆData Manipulation Languageï¼‰

### 1. select æŠ•å½±

```SQL
select branch_name from loan;
select distinct branch_name from loan;
```

### 2. where é€‰æ‹©

```SQL
select loan_number from loan
where branch_name = 'Perryridge' and amount > 1200;
```

### 3. from ç¬›å¡å°”ç§¯ + è¿æ¥

```SQL
select customer_name, amount
from borrower, loan
where borrower.loan_number = loan.loan_number;
```

### 4. rename åˆ«å

```SQL
select c.customer_name, l.amount
from borrower as c, loan as l
where c.loan_number = l.loan_number;
```

---

## ğŸ§  å››ã€å­—ç¬¦ä¸²ä¸æ’åº

```SQL
where customer_street like '%Main%'
order by customer_name desc;
```

é€šé…ç¬¦ `%` è¡¨ç¤ºä»»æ„å­ä¸²ï¼Œ`_` è¡¨ç¤ºå•ä¸ªå­—ç¬¦ã€‚

---

## â™»ï¸ äº”ã€é›†åˆæ“ä½œï¼ˆUNION / INTERSECT / EXCEPTï¼‰

|æ“ä½œ|è¯´æ˜|æ˜¯å¦å»é‡|
|---|---|---|
|UNION|å¹¶é›†|å»é‡|
|INTERSECT|äº¤é›†|å»é‡|
|EXCEPT|å·®é›†|å»é‡|
|åŠ ä¸Š `ALL`|ä¸å»é‡||

```SQL
(select customer_name from depositor)
union
(select customer_name from borrower);
```

---

## ğŸ“Š å…­ã€èšåˆå‡½æ•°ï¼ˆAggregate Functionsï¼‰

|å‡½æ•°|å«ä¹‰|
|---|---|
|`AVG()`|å¹³å‡å€¼|
|`SUM()`|æ±‚å’Œ|
|`MIN()`|æœ€å°|
|`MAX()`|æœ€å¤§|
|`COUNT()`|è®¡æ•°|

ä¾‹ï¼š

```SQL
select avg(balance) from account where branch_name='Perryridge';
select branch_name, count(*) from account group by branch_name;
select branch_name, avg(balance)
from account
group by branch_name
having avg(balance) > 1200;
```

---

## âš ï¸ ä¸ƒã€ç©ºå€¼ï¼ˆNULLï¼‰ä¸ä¸‰å€¼é€»è¾‘

- `is null` / `is not null`
- `null` ä¸ä»»ä½•æ¯”è¾ƒéƒ½è¿”å› `unknown`
- where è¿‡æ»¤æ—¶ï¼Œ`unknown` è§†ä¸º `false`
- èšåˆå‡½æ•°ï¼ˆé™¤ count(*)ï¼‰**å¿½ç•¥ null å€¼**

---

## ğŸ§© å…«ã€å­æŸ¥è¯¢ä¸é›†åˆæµ‹è¯•

### 1. in / not inï¼ˆåŒ…å«ï¼‰

```SQL
where customer_name in (select customer_name from depositor);
```

### 2. some / allï¼ˆSomeå¯ä»¥ç†è§£ä¸ºAnyï¼‰

```SQL
where assets > some (select assets from branch where branch_city='Brooklyn');
where assets > all (select assets from branch where branch_city='Brooklyn');
```

### 3. exists / not exists

```SQL
select distinct S.customer_name 
from depositor as S
where not exists (
  (select branch_name 
  from branch 
  where branch_city='Brooklyn')
  except
  (select branch_name 
  from depositor, account
  where depositor.account_number = account.account_number 
  and depositor.customer_name = S.customer_name)
);
```

---

## ğŸ§® ä¹ã€ç›¸å…³å­æŸ¥è¯¢ä¸ unique æµ‹è¯•

```SQL
where unique (
  select R.customer_name
  from account, depositor as R
  where T.customer_name = R.customer_name
  and account.branch_name = 'Perryridge'
);
```

---

## ğŸ— åã€æ´¾ç”Ÿå…³ç³»ä¸ WITH å­å¥

### Derived Table

```SQL
select branch_name, avg_balance
from (
  select branch_name, avg(balance) as avg_balance
  from account group by branch_name
) as branch_avg
where avg_balance > 1200;
```

### With ä¸´æ—¶è§†å›¾

```SQL
with max_balance(value) as (
  select max(balance) from account
)
select account_number from account, max_balance
where account.balance = max_balance.value;
```

---

## ğŸ‘ åä¸€ã€è§†å›¾ï¼ˆViewï¼‰

```SQL
create view all_customer as
(select branch_name, customer_name
 from depositor, account
 where depositor.account_number = account.account_number)
union
(select branch_name, customer_name
 from borrower, loan
 where borrower.loan_number = loan.loan_number);

select customer_name from all_customer where branch_name='Perryridge';
```

è§†å›¾æ˜¯**è™šè¡¨**ï¼Œå­˜å‚¨å®šä¹‰ä¸å­˜æ•°æ®ã€‚

---

## âœï¸ åäºŒã€æ•°æ®åº“ä¿®æ”¹

### æ’å…¥

```SQL
insert into account values ('A-9732', 'Perryridge', 1200);
insert into account select loan_number, branch_name, 200
from loan where branch_name='Perryridge';
```

### åˆ é™¤

```SQL
delete from account where branch_name='Perryridge';
```

### æ›´æ–°

```SQL
update account
set balance = case
  when balance > 10000 then balance * 1.06
  else balance * 1.05
end;
```

---

## ğŸ”— åä¸‰ã€è¿æ¥ï¼ˆJOINï¼‰

|ç±»å‹|SQL ç¤ºä¾‹|å«ä¹‰|
|---|---|---|
|å†…è¿æ¥|`A join B on cond`|åŒ¹é…çš„å…ƒç»„|
|å·¦å¤–è¿æ¥|`A left outer join B`|ä¿ç•™ A å…¨éƒ¨|
|å³å¤–è¿æ¥|`A right outer join B`|ä¿ç•™ B å…¨éƒ¨|
|å…¨å¤–è¿æ¥|`A full outer join B`|ä¿ç•™ä¸¤è¾¹|

ä¾‹ï¼š

```SQL
select customer_name
from (depositor natural full outer join borrower)
where account_number is null or loan_number is null;
```

---

# âœ… ç»“è®ºï¼šè®°å¿†ç»“æ„å›¾

```Plain
DDL: create / alter / drop
DML: select / insert / update / delete
èšåˆ: group by + having
é›†åˆ: union / intersect / except
è¿æ¥: inner / outer
å­æŸ¥è¯¢: in / exists / some / all
è§†å›¾: create view / with
```

---

è¦ä¸è¦æˆ‘å¸®ä½ å‡ºä¸€ä¸ªã€Œè¿™ç« é€Ÿé€šæ€»ç»“ç‰ˆæ€ç»´å¯¼å›¾ã€ï¼Ÿ

èƒ½ä¸€å¼ å›¾çœ‹å®Œæ‰€æœ‰ SQL çŸ¥è¯†ç‚¹ï¼ˆè¯­æ³•ã€å…³ç³»ä»£æ•°å¯¹ç…§ã€å…³é”®ä¾‹é¢˜ï¼‰ã€‚